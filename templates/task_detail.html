<div class="task-detail">
  <div class="task-detail-header">
    <h2 class="task-detail-title">{{ task.title }}</h2>
    <button class="close-modal">
      <i data-feather="x"></i>
    </button>
  </div>
  
  <div class="task-detail-content">
    <div class="task-detail-meta">
      <div class="task-meta-item">
        <div class="meta-label">Status</div>
        <div class="task-status status-{{ task.status.value }}">
          {{ task.status.value | title }}
          {% if task.status.value == 'snoozed' and task.snoozed_until %}
          <div class="snooze-until">until {{ format_datetime(task.snoozed_until) }}</div>
          {% endif %}
        </div>
      </div>
      
      <div class="task-meta-item">
        <div class="meta-label">Priority</div>
        <div class="task-priority {{ task.priority.value }}">
          <div class="priority-indicator"></div>
          {{ task.priority.value | title }}
        </div>
      </div>
      
      <div class="task-meta-item">
        <div class="meta-label">Category</div>
        {% if task.category %}
        <div class="task-category" style="background-color: {{ task.category.color }}">
          {% if task.category.icon %}
          <i data-feather="{{ task.category.icon }}" class="category-icon"></i>
          {% endif %}
          {{ task.category.name }}
        </div>
        {% else %}
        <div class="task-category uncategorized">Uncategorized</div>
        {% endif %}
      </div>
      
      <div class="task-meta-item">
        <div class="meta-label">Created</div>
        <div class="meta-value">{{ format_datetime(task.created_at) }}</div>
      </div>
      
      <div class="task-meta-item">
        <div class="meta-label">Last Modified</div>
        <div class="meta-value">{{ format_datetime(task.modified_at) }}</div>
      </div>
    </div>
    
    <div class="task-detail-sections">
      <div class="detail-section">
        <h3 class="section-title">Description</h3>
        <div class="section-content">
          {% if task.description %}
          <p class="task-description">{{ task.description }}</p>
          {% else %}
          <p class="no-content">No description provided</p>
          {% endif %}
        </div>
      </div>
      
      <div class="detail-section">
        <h3 class="section-title">Schedule</h3>
        <div class="section-content">
          <div class="cron-expression">{{ task.cron_expression }}</div>
          <div class="cron-description">{{ task.cron_expression | cron_description }}</div>
        </div>
      </div>
      
      <div class="detail-section">
        <h3 class="section-title">Notification Settings</h3>
        <div class="section-content">
          <div class="notification-detail">
            <strong>Topic:</strong> {{ task.topic }}
          </div>
          <div class="notification-detail">
            <strong>Message:</strong> {{ task.body }}
          </div>
          {% if task.notification_sound %}
          <div class="notification-detail">
            <strong>Sound:</strong> {{ task.notification_sound }}
          </div>
          {% endif %}
        </div>
      </div>
      
      {% if task.tags %}
      <div class="detail-section">
        <h3 class="section-title">Tags</h3>
        <div class="section-content">
          <div class="task-tags">
            {% for tag in task.tags %}
            <span class="task-tag">{{ tag }}</span>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
      
      {% if task.attachments %}
      <div class="detail-section">
        <h3 class="section-title">Attachments</h3>
        <div class="section-content">
          <div class="attachment-list">
            {% for attachment in task.attachments %}
            <div class="attachment-item">
              <i data-feather="paperclip"></i>
              <a href="/uploads/{{ attachment.path | basename }}" target="_blank" class="attachment-name">{{ attachment.name }}</a>
              <form hx-delete="/tasks/{{ task.id }}/attachment/{{ loop.index0 }}" hx-target=".modal-content" hx-swap="innerHTML">
                <button type="submit" class="remove-attachment" title="Remove attachment">
                  <i data-feather="x"></i>
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
      
      <div class="detail-section">
        <h3 class="section-title">Execution History</h3>
        <div class="section-content">
          {% if history %}
          <div class="history-list">
            {% for entry in history %}
            <div class="history-item">
              <div class="history-time">{{ format_datetime(entry.timestamp) }}</div>
              <div class="history-status">{{ entry.status }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <p class="no-content">No execution history yet</p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <div class="task-detail-actions">
      {% if task.status.value == 'pending' %}
      <form hx-post="/tasks/{{ task.id }}/complete" hx-target="#tasks" hx-swap="outerHTML" hx-on::after-request="document.getElementById('task-modal').classList.remove('show')">
        <button type="submit" class="btn btn-success">
          <i data-feather="check"></i>
          Mark as Completed
        </button>
      </form>
      
      <form hx-post="/tasks/{{ task.id }}/snooze" hx-target="#tasks" hx-swap="outerHTML" hx-on::after-request="document.getElementById('task-modal').classList.remove('show')">
        <div class="snooze-controls">
          <select name="hours">
            <option value="1">1 hour</option>
            <option value="6">6 hours</option>
            <option value="12">12 hours</option>
            <option value="24" selected>24 hours</option>
            <option value="48">2 days</option>
            <option value="72">3 days</option>
            <option value="168">1 week</option>
          </select>
          <button type="submit" class="btn btn-secondary">
            <i data-feather="clock"></i>
            Snooze
          </button>
        </div>
      </form>
      {% endif %}
      
      {% if task.status.value == 'completed' or task.status.value == 'snoozed' %}
      <form hx-post="/tasks/{{ task.id }}/reactivate" hx-target="#tasks" hx-swap="outerHTML" hx-on::after-request="document.getElementById('task-modal').classList.remove('show')">
        <button type="submit" class="btn btn-primary">
          <i data-feather="refresh-cw"></i>
          Reactivate Task
        </button>
      </form>
      {% endif %}
      
      <form hx-delete="/tasks/{{ task.id }}" hx-target="#tasks" hx-swap="outerHTML" hx-confirm="Delete this task?" hx-on::after-request="document.getElementById('task-modal').classList.remove('show')">
        <button type="submit" class="btn btn-danger">
          <i data-feather="trash-2"></i>
          Delete Task
        </button>
      </form>
      
      <a href="/tasks.ics?task_id={{ task.id }}" class="btn btn-outline">
        <i data-feather="calendar"></i>
        Export to Calendar
      </a>
    </div>
  </div>
</div>
